---
phase: 01-media-scanner
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - src/types.ts
autonomous: true

must_haves:
  truths:
    - "npm install succeeds with all dependencies"
    - "TypeScript compiles without errors"
    - "Type definitions exist for all scanner entities"
  artifacts:
    - path: "package.json"
      provides: "Project configuration and dependencies"
      contains: "sharp"
    - path: "tsconfig.json"
      provides: "TypeScript configuration"
      contains: "strict"
    - path: "src/types.ts"
      provides: "Shared type definitions"
      exports: ["MediaInfo", "ScanResult", "DuplicateGroup"]
  key_links:
    - from: "tsconfig.json"
      to: "src/"
      via: "include pattern"
      pattern: "src/"
---

<objective>
Initialize the media scanner project with TypeScript configuration and core type definitions.

Purpose: Establish the project foundation with proper TypeScript setup and shared types that all other modules will import.
Output: Working TypeScript project with dependencies installed and types defined.
</objective>

<execution_context>
@/Users/jamessink/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jamessink/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-media-scanner/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize TypeScript project with dependencies</name>
  <files>package.json, tsconfig.json</files>
  <action>
Create package.json with:
- name: "media-scanner"
- version: "1.0.0"
- type: "module" (ESM)
- scripts: "build" (tsc), "start" (node dist/cli.js)
- bin: { "media-scanner": "./dist/cli.js" }

Dependencies (from RESEARCH.md standard stack):
- sharp: ^0.33.0
- @ffprobe-installer/ffprobe: ^2.1.0
- commander: ^12.0.0
- ora: ^8.0.0
- cli-progress: ^3.12.0
- chalk: ^5.0.0

Dev dependencies:
- typescript: ^5.0.0
- @types/node: ^20.0.0
- @types/cli-progress: ^3.11.0

Create tsconfig.json with:
- target: "ES2022"
- module: "NodeNext"
- moduleResolution: "NodeNext"
- outDir: "./dist"
- rootDir: "./src"
- strict: true
- esModuleInterop: true
- skipLibCheck: true
- include: ["src/**/*"]

Run npm install after creating files.
  </action>
  <verify>
Run: `npm install` succeeds without errors
Run: `npx tsc --version` returns TypeScript version
  </verify>
  <done>package.json and tsconfig.json exist, npm install completes, TypeScript is available</done>
</task>

<task type="auto">
  <name>Task 2: Define core type definitions</name>
  <files>src/types.ts</files>
  <action>
Create src/types.ts with interfaces and types used across all modules:

```typescript
// Core media information returned by readers
export interface MediaInfo {
  path: string;
  type: 'image' | 'video';
  width: number;
  height: number;
  aspectRatio: number;
  is16by9: boolean;
  format: string;
  size: number;
  hash?: string;        // SHA-256 hash, populated during duplicate detection
  isDuplicate?: boolean; // True if this file has duplicates
  duplicateOf?: string;  // Path of the "original" (first encountered)
}

// Result of a complete scan operation
export interface ScanResult {
  matches: MediaInfo[];        // Files matching 16:9
  skipped: SkippedFile[];      // Files that couldn't be processed
  duplicates: DuplicateGroup[]; // Groups of duplicate files
  stats: ScanStats;
}

// Files that failed processing
export interface SkippedFile {
  path: string;
  reason: string;
}

// Group of files with identical content
export interface DuplicateGroup {
  hash: string;
  files: string[];
  count: number;
}

// Summary statistics
export interface ScanStats {
  totalFiles: number;
  imagesProcessed: number;
  videosProcessed: number;
  matchCount: number;
  duplicateCount: number;
  skippedCount: number;
  scanDuration: number; // milliseconds
}

// CLI options from commander
export interface ScanOptions {
  output?: string;
  format: 'json' | 'csv';
  duplicates: boolean;
  concurrency: number;
}

// Supported file extensions
export const IMAGE_EXTENSIONS = ['.jpg', '.jpeg', '.png', '.webp', '.avif', '.tiff', '.tif', '.gif'];
export const VIDEO_EXTENSIONS = ['.mp4', '.mov', '.avi', '.mkv', '.webm', '.m4v'];
export const SUPPORTED_EXTENSIONS = [...IMAGE_EXTENSIONS, ...VIDEO_EXTENSIONS];
```
  </action>
  <verify>
Run: `npx tsc --noEmit` succeeds (types compile)
Check: src/types.ts exports MediaInfo, ScanResult, DuplicateGroup
  </verify>
  <done>src/types.ts exists with all type definitions, TypeScript compiles without errors</done>
</task>

</tasks>

<verification>
1. `npm install` completes without errors
2. `npx tsc --noEmit` passes (TypeScript compiles)
3. package.json contains all required dependencies
4. src/types.ts exports MediaInfo, ScanResult, DuplicateGroup, ScanOptions
</verification>

<success_criteria>
- TypeScript project initialized with ESM module type
- All dependencies from RESEARCH.md standard stack installed
- Type definitions created for MediaInfo, ScanResult, DuplicateGroup, ScanOptions
- File extension constants defined for supported formats
- `npx tsc --noEmit` passes
</success_criteria>

<output>
After completion, create `.planning/phases/01-media-scanner/01-01-SUMMARY.md`
</output>
